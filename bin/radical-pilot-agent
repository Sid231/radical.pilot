#!/usr/bin/env python

__copyright__ = "Copyright 2014-2016, http://radical.rutgers.edu"
__license__   = "MIT"


import os
import sys

import saga                    as rs
import radical.utils           as ru
import radical.pilot           as rp


# this needs git attribute 'ident' set for this file
git_ident = "$Id$"

# ==============================================================================
#
if __name__ == "__main__":

    """
    This script is part of the pilot bootstrapping routine, representing the
    entry point into Python.
    """

    print sys.argv
    agent_name = str(sys.argv[1])
    agent_mode = str(sys.argv[2])

    print "---------------------------------------------------------------------"
    print
    print "PYTHONPATH: %s"  % sys.path
    print "python: %s"      % sys.version
    print "utils : %-5s : %s" % (ru.version_detail, ru.__file__)
    print "saga  : %-5s : %s" % (rs.version_detail, rs.__file__)
    print "pilot : %-5s : %s" % (rp.version_detail, rp.__file__)
    print "        type : multicore"
    print "        gitid: %s" % git_ident
    print "agent : %s [%s]"   % (agent_name, agent_mode)
    print
    print "---------------------------------------------------------------------"
    print

    if agent_mode not in ['partition', 'sub-agent']:
        raise ValueError('unknown agent-mode [%s]' % agent_mode)


    if agent_mode == 'partition':
        # spawn one agent per partition, in its own partition workdir
        print "bootstrap_3 start (%s)" % agent_name
        rp.agent.bootstrap_3(agent_name)
        print "bootstrap_3 done (%s)" % agent_name

    else:
        assert(agent_mode == 'sub-agent')

        # this is a sub agent - bootstrap it! 
        # (we are in the correct subdir already)
        print "bootstrap_4 start (%s)" % agent_name
        rp.agent.bootstrap_4(agent_name)
        print "bootstrap_4 done (%s)" % agent_name
#
# ------------------------------------------------------------------------------

